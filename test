import subprocess
import time

MY_COOKIE = "_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-as-you-and-to-steal-your-ROBUX-and-items.|_CAEaAhADIhwKBGR1aWQSFDEwNTAxOTk1ODgxOTczMjgzNDc1KAM.K_gMy3tCQ0KZxZlwirOxqpIwxATitqRN4aaka_b7n0b0qvn6Af-ZH2oyOoNXj3FoGe2u9_RDiUOD24ipW4SGBuYayFwIt5OzfiFAU8HzzIsVDz1GyfKRnn-X3vijUVqM9DQrNQEAONL4jtCX7cgZfNywQOrYxKqcQRg1eyy45g7lhz7flC7SVnhTMB7U9vcanh9CI4ixsHKvGZYtIKzEsvR5f0rjO9evtqURbortrkXq80pFAeZU2UVhnW4R8U85eO193zk_7pv8JaKcz_NklQhO2xxCmMipRstDe-M_fYhGtFltl4olXVagx7SYoUgX-UqYZgaRmGbmxt9LQC-uZJ_-yJZalxHNQGstudubVpcWQFUbPUUjZrnZSHXo2NL8nZORTNyosZJMShdK553t2eLBZv8ocnoCbpRUktt9z9Hsg8rx7G2SWF3ZpMdQFmDIIFymM5YQugkndXdzwqjtaRUYoMZ8XL8mjqPexp6W-rIMUUpMkhfFif9sgQVWP0UtmVAMcWgehGhMjnLxnWKm2i9NRByzjjfBO6mjqAdC3d2lfCCaa2ICWF5j3gWDBRsCuLKpg7uUYy-Vp_Bp00rNN4sGsSZ8yqA79mpmoHHFifwAycURfjtortETJH9nzYSYGwexcA"
PACKAGE_NAME = "com.roblox.clieng"
PLACE_ID = "8737602449"

DB_PATH = f"/data/data/{PACKAGE_NAME}/app_webview/Default/Cookies"
TMP_PATH = "/data/local/tmp/cookies_fixed.db"

def su(cmd):
    return subprocess.run(
        ["su", "-c", cmd],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True
    )

def inject_cookie():
    print("[*] Stopping app...")
    su(f"am force-stop {PACKAGE_NAME}")
    su(f"rm -f {DB_PATH}-wal {DB_PATH}-shm")
    time.sleep(1)

    print("[*] Copy database...")
    su(f"cp {DB_PATH} {TMP_PATH}")
    su(f"chmod 777 {TMP_PATH}")

    print("[*] Inject cookie via root sqlite...")
    sql = f"""
    sqlite3 {TMP_PATH} "
    DELETE FROM cookies
    WHERE host_key='.roblox.com'
    AND name='.ROBLOSECURITY';

    INSERT INTO cookies
    (creation_utc, host_key, name, value, path, expires_utc,
     is_secure, is_httponly, last_access_utc,
     has_expires, is_persistent, priority, samesite, source_scheme)
    VALUES
    (strftime('%s','now'), '.roblox.com', '.ROBLOSECURITY', '{MY_COOKIE}',
     '/', 253402300799, 1, 1,
     strftime('%s','now'), 1, 1, 1, -1, 2);
    "
    """
    su(sql)

    print("[*] Restore database...")
    su(f"cp {TMP_PATH} {DB_PATH}")

    uid = su(f"stat -c '%u:%g' /data/data/{PACKAGE_NAME}").stdout.strip()
    su(f"chown {uid} {DB_PATH}")
    su(f"chmod 660 {DB_PATH}")
    su(f"restorecon {DB_PATH}")

    su(f"rm {TMP_PATH}")

    print("[âœ“] Cookie injected successfully")

def launch():
    link = f"roblox://placeID={PLACE_ID}"
    su(f"am start -n {PACKAGE_NAME}/com.roblox.client.startup.ActivitySplash -d {link}")
    time.sleep(5)
    su(f"am start -n {PACKAGE_NAME}/com.roblox.client.ActivityProtocolLaunch -d {link}")

if __name__ == "__main__":
    inject_cookie()
    launch()
