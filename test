import subprocess
import time

# ================= CONFIGURATION =================
# D√°n Cookie .ROBLOSECURITY c·ªßa b·∫°n v√†o ƒë√¢y
MY_COOKIE = "_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-as-you-and-to-steal-your-ROBUX-and-items.|_CAEaAhADIhwKBGR1aWQSFDEwNTAxOTk1ODgxOTczMjgzNDc1KAM.K_gMy3tCQ0KZxZlwirOxqpIwxATitqRN4aaka_b7n0b0qvn6Af-ZH2oyOoNXj3FoGe2u9_RDiUOD24ipW4SGBuYayFwIt5OzfiFAU8HzzIsVDz1GyfKRnn-X3vijUVqM9DQrNQEAONL4jtCX7cgZfNywQOrYxKqcQRg1eyy45g7lhz7flC7SVnhTMB7U9vcanh9CI4ixsHKvGZYtIKzEsvR5f0rjO9evtqURbortrkXq80pFAeZU2UVhnW4R8U85eO193zk_7pv8JaKcz_NklQhO2xxCmMipRstDe-M_fYhGtFltl4olXVagx7SYoUgX-UqYZgaRmGbmxt9LQC-uZJ_-yJZalxHNQGstudubVpcWQFUbPUUjZrnZSHXo2NL8nZORTNyosZJMShdK553t2eLBZv8ocnoCbpRUktt9z9Hsg8rx7G2SWF3ZpMdQFmDIIFymM5YQugkndXdzwqjtaRUYoMZ8XL8mjqPexp6W-rIMUUpMkhfFif9sgQVWP0UtmVAMcWgehGhMjnLxnWKm2i9NRByzjjfBO6mjqAdC3d2lfCCaa2ICWF5j3gWDBRsCuLKpg7uUYy-Vp_Bp00rNN4sGsSZ8yqA79mpmoHHFifwAycURfjtortETJH9nzYSYGwexcA"

# ID c·ªßa game b·∫°n mu·ªën v√†o (V√≠ d·ª•: Blox Fruits l√† 2711202336)
PLACE_ID = "2711202336" 

PACKAGE_NAME = "com.roblox.client"
DB_PATH = f"/data/data/{PACKAGE_NAME}/app_webview/Default/Cookies"
# =================================================

def run_shell(command):
    """Ch·∫°y l·ªánh shell v·ªõi quy·ªÅn Root"""
    return subprocess.run(['su', '-c', command], capture_output=True, text=True)

def inject_and_rejoin():
    print("üöÄ B·∫Øt ƒë·∫ßu quy tr√¨nh Auto Login & Rejoin...")

    # 1. T·∫Øt Roblox
    print("üõë ƒêang t·∫Øt Roblox...")
    run_shell(f"am force-stop {PACKAGE_NAME}")
    time.sleep(1)

    # 2. Inject Cookie v√†o Database SQLite
    # L·ªánh n√†y s·∫Ω x√≥a cookie c≈© v√† ch√®n cookie c·ªßa b·∫°n v√†o
    print("üíæ ƒêang n·∫°p Cookie v√†o h·ªá th·ªëng...")
    sql_cmd = (
        f"DELETE FROM cookies WHERE host_key = '.roblox.com' AND name = '.ROBLOSECURITY';"
        f"INSERT INTO cookies (creation_utc, host_key, name, value, path, expires_utc, is_secure, is_httponly, last_access_utc, has_expires, is_persistent, priority, samesite, source_scheme) "
        f"VALUES ({int(time.time())}, '.roblox.com', '.ROBLOSECURITY', '{MY_COOKIE}', '/', 253402300799, 1, 1, {int(time.time())}, 1, 1, 1, -1, 2);"
    )
    
    result = run_shell(f"sqlite3 {DB_PATH} \"{sql_cmd}\"")
    
    if result.returncode != 0:
        print(f"‚ùå L·ªói khi n·∫°p Cookie: {result.stderr}")
        return

    # 3. M·ªü game v·ªõi Place ID (Rejoin)
    print(f"üéÆ ƒêang Rejoin v√†o game ID: {PLACE_ID}...")
    game_url = f"roblox://placeID={PLACE_ID}"
    
    # B∆∞·ªõc kh·ªüi ƒë·ªông 1: Splash Screen
    run_shell(f"am start -n {PACKAGE_NAME}/com.roblox.client.startup.ActivitySplash -d {game_url}")
    time.sleep(5)
    
    # B∆∞·ªõc kh·ªüi ƒë·ªông 2: V√†o th·∫≥ng Game
    run_shell(f"am start -n {PACKAGE_NAME}/com.roblox.client.ActivityProtocolLaunch -d {game_url}")

    print("‚úÖ Ho√†n t·∫•t! Roblox ƒëang kh·ªüi ƒë·ªông v√† t·ª± ƒëƒÉng nh·∫≠p...")

if __name__ == "__main__":
    if "WARNING" not in MY_COOKIE:
        print("‚ùå L·ªói: B·∫°n ch∆∞a d√°n ƒë√∫ng ƒë·ªãnh d·∫°ng Cookie v√†o bi·∫øn MY_COOKIE!")
    else:
        inject_and_rejoin()
