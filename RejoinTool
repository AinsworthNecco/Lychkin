#!/data/data/com.termux/files/usr/bin/bash
# Script Roblox voi logic sieu don gian: Cu 5 phut la gui lenh join lai cho tat ca.
# LOGIC: Khong kiem tra, khong quan tam trang thai, chi lap di lap lai hanh dong join.
#---------------------------------------------------
# -- CAI DAT CHINH --
# Tat ca cac tuy chinh deu o day.
#---------------------------------------------------

# Them hoac xoa cac hau to phien ban ban muon mo (phan cach boi dau cach)
Suffixes="b c d e f"

# URL cua VIP Server ban muon tham gia
VipServerUrl="roblox://placeId=8737602449"

# Thoi gian (giay) cho giua moi lan gui lenh join
OpenDelay=10

# Thoi gian (giay) script se cho truoc khi lap lai chu ky join (300 giay = 5 phut)
RejoinInterval=60

# Ten goi co ban cua Roblox (khong nen thay doi)
BasePackageName="com.roblox.clien"

#---------------------------------------------------
# -- LOGIC CHINH --
# Khong can sua phan duoi day.
#---------------------------------------------------

echo "--- KHOI DONG SCRIPT FORCE REJOIN ROBLOX ---"
echo "Chu ky gui lai lenh join: $RejoinInterval giay."

# Chuyen chuoi Suffixes thanh mot mang cac ten goi day du
read -r -a suffixes_array <<< "$Suffixes"
all_packages=()
for suffix in "${suffixes_array[@]}"; do
    all_packages+=("${BasePackageName}${suffix}")
done
totalInstances=${#all_packages[@]}

if (( totalInstances == 0 )); then
    echo "Loi: Vui long dinh nghia it nhat mot hau to trong bien 'Suffixes'."
    exit 1
fi

# Ham thuc hien viec gui lai lenh join cho tat ca
function force_rejoin_all() {
    echo "================================================="
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] BAT DAU CHU KY MOI. Gui lenh join cho $totalInstances phien ban..."
    for package in "${all_packages[@]}"; do
        echo "  => Gui lenh join den: $package"
        # Su dung 'am start' de gui intent tham gia server
        am start -a android.intent.action.VIEW -d "$VipServerUrl" -p "$package"
        # Cho mot chut de he thong khong bi qua tai
        sleep "$OpenDelay"
    done
    echo "Da hoan tat gui lenh cho tat ca."
}

# Vong lap chinh, chay vo han
while true; do
    # Luon luon goi ham de gui lenh join
    force_rejoin_all

    # Cho het 5 phut roi lap lai
    echo "-------------------------------------------------"
    echo "Script se cho $RejoinInterval giay truoc khi bat dau lai tu dau."
    sleep "$RejoinInterval"
done

exit 0
