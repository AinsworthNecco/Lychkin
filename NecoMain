local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Configuration
local language = "en" -- Language: "en" for English
local censorSwearing = "true" -- "true" to censor swearing, "false" to allow

-- Get the local player
local localPlayer = Players.LocalPlayer

-- Function to get SimSimi response
local function getSimSimiResponse(text)
	local success, result = pcall(function()
		local url = string.format("https://api.simsimi.net/v2/?text=%s&lc=%s&cf=%s", HttpService:UrlEncode(text), language, censorSwearing)
		return HttpService:JSONDecode(game:HttpGet(url))
	end)
	if success and result and result.success then
		return result.success
	else
		return nil
	end
end

-- Listen to other players chatting
for _, player in ipairs(Players:GetPlayers()) do
	if player ~= localPlayer then
		player.Chatted:Connect(function(message)
			local character = player.Character
			local localCharacter = localPlayer.Character
			if character and localCharacter and character:FindFirstChild("HumanoidRootPart") and localCharacter:FindFirstChild("HumanoidRootPart") then
				local distance = (character.HumanoidRootPart.Position - localCharacter.HumanoidRootPart.Position).Magnitude
				if distance <= 10 then
					local response = getSimSimiResponse(message)
					if response then
						ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(player.Name .. ": " .. response, "All")
					end
				end
			end
		end)
	end
end

-- Listen to new players joining
Players.PlayerAdded:Connect(function(player)
	player.Chatted:Connect(function(message)
		local character = player.Character or player.CharacterAdded:Wait()
		local localCharacter = localPlayer.Character or localPlayer.CharacterAdded:Wait()
		if character and localCharacter and character:FindFirstChild("HumanoidRootPart") and localCharacter:FindFirstChild("HumanoidRootPart") then
			local distance = (character.HumanoidRootPart.Position - localCharacter.HumanoidRootPart.Position).Magnitude
			if distance <= 10 then
				local response = getSimSimiResponse(message)
				if response then
					ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(player.Name .. ": " .. response, "All")
				end
			end
		end
	end)
end)
